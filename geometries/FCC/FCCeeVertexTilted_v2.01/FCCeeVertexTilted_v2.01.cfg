@include SimParms


BeamPipe Pipe {

// 2D Beam-pipe: original shape withou flanges
    radius         15.00,15.00 // mm (N-points defining contour)
    zPos           0.000,18000 // mm (N-points defining contour)
    thickness      0.8         // N-1 segments thickness in mm
    radLength      352.8       // N-1 segments rad. length in mm
    intLength      421.0       // N-1 segments int. length in mm

}

Tracker Inner {

    // Layout construction parameters
    bigDelta 5
    smallDelta 2.5
    zOverlap 0.0
    phiOverlap 0.0 
    rOverlap 0.0 
    barrelRotation 1.5707963268 // Starts building modules from X=0, Ymax
    smallParity -1
    bigParity 1
    innerRadiusFixed true 
    outerRadiusFixed true
    //useMinMaxRCorrect false

    // Detector constraints
    etaCut 3

    trackingTags inner,tracker
    
    Barrel BRL {
      
      numLayers 3
      innerRadius 23.5
      outerRadius 460.0
      // outerZ 820 // Use only if tilted not defined
      // phiSegments 2 // Use only if tilted not defined
      
      zOverlap 1.25
      phiOverlap 0.5
      rOverlap 0.5

      //sameRods true
      radiusMode fixed
      startZMode modulecenter

      // Tilted don't use automatic placement
      Layer 1 { radius  17.5 }
      Layer 2 { radius  37.0 } 
      Layer 3 { radius 57.0 } 
      
      // General info 
      Layer 1 {
       
       isTilted true
       isTiltedAuto true


       bigDelta 1.0
       smallDelta 0.0
       width 12.8
       length 25.6
       physicalLength 25.6       
       moduleType pixel
       plotColor 2
       @include Pixel_BRL_module0.cfg
       @include Pixel_material_innermost.cfg
       resolutionLocalX 0.0075 // Pitch ~25um
       resolutionLocalY 0.015  // Pitch ~50um
      }
      Layer 2-3 {

       isTilted true
       isTiltedAuto true

       bigDelta 1.0
       smallDelta 0.0
       width 25.6
       length 25.6
       physicalLength 25.6
       moduleType pixel
       plotColor 2
       @include Pixel_BRL_module1.cfg
       @include Pixel_material_innermost.cfg
       resolutionLocalX 0.0075 // Pitch ~25um
       resolutionLocalY 0.015  // Pitch ~50um
      }

      // Detailed description
      Layer 1 {
       
       numModulesFlat 2
       numModulesTilted 10

       numberRods 14  // 14 originally in flat layout
       
       Ring 3-15 {
         ringInnerRadius 17.5
         ringOuterRadius 18.5
         tiltAngle 10.0
         theta_g 90.0
       }
       // Set Z overlap in a way to have +-75mm zError coverage
       Ring 3  { ringZOverlap 4.5 }
       Ring 4  { ringZOverlap 7.0 }
       Ring 5  { ringZOverlap 6.15 }
       Ring 6  { ringZOverlap 5.5 }
       Ring 7 { ringZOverlap 4.8 }
       Ring 8 { ringZOverlap 5.0 } // Shorten ring to finish @ 800mm
       Ring 9 { ringZOverlap 5.0 } // Shorten ring to finish @ 800mm
       Ring 10 { ringZOverlap 5.0 } // Shorten ring to finish @ 800mm
       Ring 11 { ringZOverlap 5.0 } // Shorten ring to finish @ 800mm
       Ring 12 { ringZOverlap 4.5 } // Shorten ring to finish @ 800mm
      }
      Layer 2 {
       
       numModulesFlat 3
       numModulesTilted 5

       numberRods 18  // 16 originally in flat layout
       
       Ring 4-8 {
         ringInnerRadius 36.50
         ringOuterRadius 37.50
         tiltAngle 70.5
         theta_g 29.5
       }
       Ring 9-10 {
         ringInnerRadius 36.5
         ringOuterRadius 37.5
         tiltAngle 79.2
         theta_g 20.8
       }
       Ring 11-13 {
         ringInnerRadius 36.5
         ringOuterRadius 37.5
         tiltAngle 83.9
         theta_g 16.1
       }
       // Set Z overlap in a way to have +-75mm zError coverage
       Ring 4  { ringZOverlap 5.95 }
       Ring 5  { ringZOverlap 11.2 }
       Ring 6  { ringZOverlap 9.00 }
       Ring 7 { ringZOverlap 6.90 }
       Ring 8 { ringZOverlap 12.1 } // Shorten ring to finish @ 800mm
       Ring 9 { ringZOverlap 12.1 } // Shorten ring to finish @ 800mm
       Ring 10 { ringZOverlap 12.065 } // Shorten ring to finish @ 800mm
      }
      Layer 3 {
       
       numModulesFlat 3
       numModulesTilted 7

       numberRods 28  // 26 originally in flat layout
       
       Ring 4-5 {
         ringInnerRadius 56.50
         ringOuterRadius 57.50
         tiltAngle 58.3
         theta_g 41.7
       }
       Ring 6-7 {
         ringInnerRadius 56.50
         ringOuterRadius 57.50
         tiltAngle 67.5
         theta_g 32.5
       }
       Ring 8-15 {
         ringInnerRadius 56.50
         ringOuterRadius 57.50
         tiltAngle 74.8
         theta_g 25.2
       }
      // Ring 13-14 {
      //   ringInnerRadius 56.50
      //   ringOuterRadius 57.50
      //   tiltAngle 80.0
      //   theta_g 20.0
      // }
      // Ring 15 {
      //   ringInnerRadius 56.50
      //   ringOuterRadius 57.50
      //   tiltAngle 84.0
      //   theta_g 16.0
      // }
       // Set Z overlap in a way to have +-75mm zError coverage
       Ring 4  { ringZOverlap 4.65 }
       Ring 5  { ringZOverlap 9.20 }
       Ring 6  { ringZOverlap 8.25 }
       Ring 7 { ringZOverlap 7.35 }
       Ring 8 { ringZOverlap 6.35 }
       Ring 9 { ringZOverlap 5.40 }
       Ring 10 { ringZOverlap 4.45 }
       Ring 11 { ringZOverlap 3.65 }
       Ring 12 { ringZOverlap 4.74 } // Shorten ring to finish @ 800mm
      }
    }

//    Endcap ECAP {
//      //@includestd Conversions/flangeTEDD
//          
//      phiSegments 4
//      numDisks 3
//      innerRadius 24
//      outerRadius 102
//      barrelGap 150 // Service channel between BRL & ECAP
//      innerZ 160
//      outerZ 300 
//      alignEdges false
//      moduleShape wedge
//      moduleType pixel    
// 
//      Disk 1-3 {
//        Ring 1 {
//          waferDiameter 36.2
//          additionalModules 0
//          moduleType pixel
//          @include Pixel_InnerFwd_module0.cfg
//          @include Pixel_material.cfg
//          resolutionLocalX 0.0075 // Pitch ~25um
//          resolutionLocalY 0.015  // Pitch ~50um
//          plotColor 11 
//        }
//        Ring 2 {
//          waferDiameter 33.0
//          additionalModules 2
//          moduleType pixel
//          @include Pixel_InnerFwd_module1.cfg
//          @include Pixel_material.cfg
//          resolutionLocalX 0.0095 // Pitch ~100/3um
//          resolutionLocalY 0.030  // Pitch ~100um
//          plotColor 5
//        }
//        Ring 3 {
//          waferDiameter 34.8
//          additionalModules 3
//          moduleType macroPixel
//          @include MacroPixel_InnerFwd_module0.cfg
//          @include MacroPixel_material.cfg
//          resolutionLocalX 0.0095 // Pitch ~100/3um
//          resolutionLocalY 0.115  // Pitch ~400um
//          plotColor 7
//        }
//      }
//    }
}
